#!/bin/bash

# ============================================================================
# ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ• Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ + Ð°Ð»ÐµÑ€Ñ‚Ñ‹
# ============================================================================
# 
# Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚:
# 1. âŒ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ (ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²)
# 2. âŒ ÐŸÐ¾ÑÐ²Ð»ÑÑŽÑ‚ÑÑ Ð°Ð»ÐµÑ€Ñ‚Ñ‹ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
# 
# ============================================================================

set -e

GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

BOT_DIR="/root/Work/error_bot"
BACKUP_DIR="${BOT_DIR}/backups/critical_fix_$(date +%Y%m%d_%H%M%S)"

echo -e "${GREEN}ðŸ”§ ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ• Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•${NC}"
echo "================================"
echo ""

# ============================================================================
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ Ð¼Ñ‹ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
# ============================================================================
if [ ! -f "main.py" ]; then
    echo -e "${RED}âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: main.py Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!${NC}"
    echo "Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸Ð· Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð±Ð¾Ñ‚Ð°:"
    echo "  cd $BOT_DIR"
    echo "  ./scripts/apply_critical_fixes.sh"
    exit 1
fi

# ============================================================================
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±ÑÐºÐ°Ð¿Ð¾Ð²
# ============================================================================
echo -e "${YELLOW}ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±ÑÐºÐ°Ð¿Ð¾Ð²...${NC}"
mkdir -p "$BACKUP_DIR"

cp handlers/quick_errors.py "$BACKUP_DIR/" 2>/dev/null || true
cp handlers/messages.py "$BACKUP_DIR/" 2>/dev/null || true
cp main.py "$BACKUP_DIR/" 2>/dev/null || true

echo -e "${GREEN}âœ… Ð‘ÑÐºÐ°Ð¿Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹: $BACKUP_DIR${NC}"
echo ""

# ============================================================================
# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð¾Ñ‚Ð°
# ============================================================================
echo -e "${YELLOW}ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð¾Ñ‚Ð°...${NC}"

if systemctl is-active --quiet error_bot; then
    sudo systemctl stop error_bot
    sleep 2
    echo -e "${GREEN}âœ… Ð‘Ð¾Ñ‚ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½${NC}"
else
    echo -e "${YELLOW}â„¹ï¸  Ð‘Ð¾Ñ‚ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½${NC}"
fi

echo ""

# ============================================================================
# Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ ÐŸÐž ÐŸÐ Ð˜ÐœÐ•ÐÐ•ÐÐ˜Ð® Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð™
# ============================================================================
echo -e "${YELLOW}ðŸ“ ÐŸÐ Ð˜ÐœÐ•ÐÐ•ÐÐ˜Ð• Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð™${NC}"
echo "================================"
echo ""
echo "Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ð¸Ð· Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ð¾Ð² Claude:"
echo ""
echo -e "${GREEN}1ï¸âƒ£  handlers/quick_errors.py${NC}"
echo "    ÐÑ€Ñ‚ÐµÑ„Ð°ÐºÑ‚: quick_errors_fixed.py"
echo "    Ð¤Ð°Ð¹Ð»: handlers/quick_errors.py"
echo ""
echo -e "${GREEN}2ï¸âƒ£  handlers/messages.py${NC}"
echo "    ÐÑ€Ñ‚ÐµÑ„Ð°ÐºÑ‚: messages_fixed.py"
echo "    Ð¤Ð°Ð¹Ð»: handlers/messages.py"
echo ""
echo -e "${GREEN}3ï¸âƒ£  main.py${NC}"
echo "    ÐÑ€Ñ‚ÐµÑ„Ð°ÐºÑ‚: main_fixed.py"
echo "    Ð¤Ð°Ð¹Ð»: main.py"
echo ""
read -p "Ð¤Ð°Ð¹Ð»Ñ‹ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹? (y/n): " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo -e "${RED}âŒ ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾${NC}"
    echo ""
    echo "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð°:"
    echo "  sudo systemctl start error_bot"
    exit 1
fi

# ============================================================================
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°
# ============================================================================
echo ""
echo -e "${YELLOW}ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°...${NC}"

errors=0

if python3 -m py_compile handlers/quick_errors.py 2>/dev/null; then
    echo -e "${GREEN}   âœ… handlers/quick_errors.py${NC}"
else
    echo -e "${RED}   âŒ handlers/quick_errors.py - ÐžÐ¨Ð˜Ð‘ÐšÐ Ð¡Ð˜ÐÐ¢ÐÐšÐ¡Ð˜Ð¡Ð!${NC}"
    errors=$((errors+1))
fi

if python3 -m py_compile handlers/messages.py 2>/dev/null; then
    echo -e "${GREEN}   âœ… handlers/messages.py${NC}"
else
    echo -e "${RED}   âŒ handlers/messages.py - ÐžÐ¨Ð˜Ð‘ÐšÐ Ð¡Ð˜ÐÐ¢ÐÐšÐ¡Ð˜Ð¡Ð!${NC}"
    errors=$((errors+1))
fi

if python3 -m py_compile main.py 2>/dev/null; then
    echo -e "${GREEN}   âœ… main.py${NC}"
else
    echo -e "${RED}   âŒ main.py - ÐžÐ¨Ð˜Ð‘ÐšÐ Ð¡Ð˜ÐÐ¢ÐÐšÐ¡Ð˜Ð¡Ð!${NC}"
    errors=$((errors+1))
fi

echo ""

if [ $errors -gt 0 ]; then
    echo -e "${RED}âŒ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°!${NC}"
    echo ""
    echo "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð· Ð±ÑÐºÐ°Ð¿Ð°:"
    echo "  cp $BACKUP_DIR/* $BOT_DIR/handlers/"
    echo "  cp $BACKUP_DIR/main.py $BOT_DIR/"
    echo ""
    read -p "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð½ÐµÑÐ¼Ð¾Ñ‚Ñ€Ñ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ¸? (y/n): " -n 1 -r
    echo ""
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# ============================================================================
# Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
# ============================================================================
echo -e "${YELLOW}ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°...${NC}"

sudo systemctl start error_bot
sleep 3

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»ÑÑ
if systemctl is-active --quiet error_bot; then
    echo -e "${GREEN}âœ… Ð‘Ð¾Ñ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!${NC}"
    echo ""
    echo -e "${GREEN}ðŸ“‹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸:${NC}"
    echo "  sudo journalctl -u error_bot -f"
    echo ""
    echo "  Ð¸Ð»Ð¸:"
    echo "  tail -f bot.log"
else
    echo -e "${RED}âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°!${NC}"
    echo ""
    echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ:"
    echo "  sudo systemctl status error_bot"
    echo ""
    echo "Ð›Ð¾Ð³Ð¸:"
    echo "  sudo journalctl -u error_bot -n 50"
    echo ""
    echo "Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð· Ð±ÑÐºÐ°Ð¿Ð°:"
    echo "  sudo systemctl stop error_bot"
    echo "  cp $BACKUP_DIR/* ."
    echo "  sudo systemctl start error_bot"
    exit 1
fi

echo ""

# ============================================================================
# Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•
# ============================================================================
echo -e "${YELLOW}ðŸ§ª Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•${NC}"
echo "================================"
echo ""
echo -e "${GREEN}ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐµ:${NC}"
echo ""
echo "1ï¸âƒ£  Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:"
echo "   â€¢ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð¾Ð¼ â†’ âš¡ï¸ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸"
echo "   â€¢ Ð’Ð¸Ð´Ð½Ñ‹ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»Ð¸ Ð´Ð»Ñ Ð±ÐµÐ»Ñ‹Ñ… Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸Ð¹"
echo "   â€¢ ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð±ÐµÐ· Ð°Ð»ÐµÑ€Ñ‚Ð¾Ð²"
echo "   â€¢ Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´Ð»Ñ BMW"
echo "   â€¢ ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ BMW Ð² Ð¼ÐµÐ½ÑŽ â†’ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸"
echo ""
echo "2ï¸âƒ£  ÐÐ»ÐµÑ€Ñ‚Ñ‹ Ð² ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸:"
echo "   â€¢ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð¾Ð¼ â†’ Ð»ÑŽÐ±Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°"
echo "   â€¢ ÐÐ• Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð°Ð»ÐµÑ€Ñ‚Ð¾Ð² 'ÐºÐ½Ð¾Ð¿ÐºÐ° Ð½Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°'"
echo "   â€¢ Ð’ÑÑ‘ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¿Ð»Ð°Ð²Ð½Ð¾"
echo ""
echo "3ï¸âƒ£  ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸Ð¸:"
echo "   â€¢ Ð’Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´Ð»Ñ BMW"
echo "   â€¢ ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ BMW â†’ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ (Ð½Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸)"
echo "   â€¢ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ â†’ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ"
echo ""

# ============================================================================
# Ð˜Ð¢ÐžÐ“Ð˜
# ============================================================================
echo ""
echo "================================"
echo -e "${GREEN}âœ… Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð¯ ÐŸÐ Ð˜ÐœÐ•ÐÐ•ÐÐ«${NC}"
echo "================================"
echo ""
echo -e "${YELLOW}ðŸ“¦ Ð‘ÑÐºÐ°Ð¿Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹:${NC}"
echo "  $BACKUP_DIR"
echo ""
echo -e "${YELLOW}ðŸ“ Ð§Ñ‚Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾:${NC}"
echo "  âœ… Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚"
echo "  âœ… Ð£Ð±Ñ€Ð°Ð½ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¼ Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ð¼ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸Ð¸"
echo "  âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð°Ð»ÐµÑ€Ñ‚Ñ‹ Ð² ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸"
echo "  âœ… Fallback callback Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾"
echo ""
echo -e "${YELLOW}ðŸ” ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³:${NC}"
echo "  sudo journalctl -u error_bot -f"
echo ""
echo -e "${YELLOW}ðŸ“Š ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:${NC}"
echo "  /health Ð² Ð±Ð¾Ñ‚Ðµ"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°
cat > "$BACKUP_DIR/CRITICAL_FIX_REPORT.txt" << EOF
====================================
CRITICAL FIX REPORT
====================================
Ð”Ð°Ñ‚Ð°: $(date +"%Y-%m-%d %H:%M:%S")

ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ«:
1. âŒ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸
   - ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°: ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² Ð² quick_errors.py Ð¸ messages.py
   - ÐžÐ±Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° Ð¿Ñ‹Ñ‚Ð°Ð»Ð¸ÑÑŒ Ð¿Ð¾Ð¹Ð¼Ð°Ñ‚ÑŒ Ð¾Ð´Ð½Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ

2. âŒ ÐÐ»ÐµÑ€Ñ‚Ñ‹ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
   - ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°: fallback_callback Ð±Ñ‹Ð» Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ñ‘Ð½
   - Callback'Ð¸ Ð½Ðµ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð»Ð¸ ÑÐ²Ð¾Ð¸Ñ… Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð²

Ð Ð•Ð¨Ð•ÐÐ˜Ð•:
1. âœ… handlers/quick_errors.py
   - Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ quick_errors_enabled Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð¸Ð· Ð‘Ð”
   - Ð£Ð±Ñ€Ð°Ð½Ð° Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ is_quick_errors_telephony()

2. âœ… handlers/messages.py
   - handle_telephony_choice() Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ quick_errors_enabled
   - Ð•ÑÐ»Ð¸ Ð’ÐšÐ›Ð®Ð§Ð•ÐÐ« â†’ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ (Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ quick_errors.py)
   - Ð•ÑÐ»Ð¸ Ð’Ð«ÐšÐ›Ð®Ð§Ð•ÐÐ« â†’ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ðº Ð¾Ð±Ñ‹Ñ‡Ð½ÑƒÑŽ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸ÑŽ

3. âœ… main.py
   - fallback_callback Ð’ÐšÐ›Ð®Ð§ÐÐ Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½
   - Callback handlers Ð² group=0
   - ConversationHandler'Ñ‹ Ð² group=1
   - Message handlers Ð² group=2

Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•:
1. Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:
   âœ… ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð±ÐµÐ· Ð°Ð»ÐµÑ€Ñ‚Ð¾Ð²
   âœ… Ð’ÐºÐ»ÑŽÑ‡Ñ‘Ð½Ð½Ð°Ñ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸Ñ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ½Ð¾Ð¿ÐºÐ¸
   âœ… Ð’Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ð°Ñ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸Ñ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ

2. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ:
   âœ… ÐÐµÑ‚ Ð°Ð»ÐµÑ€Ñ‚Ð¾Ð² Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº
   âœ… Ð’ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¿Ð»Ð°Ð²Ð½Ð¾

3. ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ð¸Ð¸:
   âœ… Ð Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÐºÐ°Ðº Ñ€Ð°Ð½ÑŒÑˆÐµ

Ð‘Ð­ÐšÐÐŸÐ«:
Ð Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ: $BACKUP_DIR
Ð¤Ð°Ð¹Ð»Ñ‹:
  - handlers/quick_errors.py
  - handlers/messages.py
  - main.py

ÐžÐ¢ÐšÐÐ¢ (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾):
  sudo systemctl stop error_bot
  cp $BACKUP_DIR/* $BOT_DIR/handlers/
  cp $BACKUP_DIR/main.py $BOT_DIR/
  sudo systemctl start error_bot
====================================
EOF

echo -e "${GREEN}ðŸ“„ ÐžÑ‚Ñ‡Ñ‘Ñ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½:${NC}"
echo "  $BACKUP_DIR/CRITICAL_FIX_REPORT.txt"
echo ""